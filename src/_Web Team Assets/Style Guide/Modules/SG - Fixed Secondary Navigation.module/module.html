{#
CHANGE LOG:
---------------
04.08.19 Pat - update languageConstructor path
#}

{%- unless pageLang is defined -%}
	{% from '_Web_Team_Assets/globals/languageConstructor.html' import pageLang %}
{% endunless -%}

{%- unless generateHubDBSecondaryNavigation is defined -%}
  {% from '/_Web Team Assets/Style Guide/Macros/secondaryNavigation.html' import generateHubDBSecondaryNavigation %}
{% endunless -%}

{%- unless generateCta is defined -%}
  {% from '/_Web Team Assets/Style Guide/Macros/cta.html' import generateCta %}
{% endunless -%}

{%- set controlsToggleId = name ~ '-controls' -%}

{%- set isBasicNav = (module.link_type is equalto 'basic') and module.links|length -%}
{%- set isAutoGeneratedNav = (module.link_type is equalto 'auto') -%}
{%- set isHubDBNav = (module.link_type is equalto 'hubdb') and (module.hubdb_table_id is truthy) -%}

{%- if isBasicNav or isAutoGeneratedNav or isHubDBNav -%}
<div data-fixed-element="placeholder">
  <section class="hsg-fixed-secondary"
    data-auto-links="{{ isAutoGeneratedNav }}"
    data-fixed-element="target">
    <div class="hsg-fixed-secondary__layout">
      <input
        id="{{ controlsToggleId }}"
        name="{{ controlsToggleId }}"
        class="hsg-fixed-secondary__controls-toggle"
        type="checkbox">
      <div class="hsg-fixed-secondary__controls">
        <label for="{{ controlsToggleId }}">
          <span>{{ module.optional_fields.mobile_title }}</span>
        </label>
      </div>

      <nav class="hsg-fixed-secondary__nav-container">
        {% if isHubDBNav -%}
        {%- set filters = '&visible__eq=1&orderBy=order&orderBy=name&language__eq=' ~ (pageLang or 'en') -%}

        {{ generateHubDBSecondaryNavigation({
          'tableId': module.hubdb_table_id,
          'filters': filters
        }) }}
        {% else %}
        <ul class="hsg-fixed-secondary__nav">
          {% unless isAutoGeneratedNav -%}
            {% for link in module.links -%}
              {% if link.link_label -%}
              <li class="hsg-fixed-secondary__nav-item--primary">
                <a href="{{ link.link_url }}">{{ link.link_label }}</a>
              </li>
              {% endif -%}
            {% endfor -%}
          {% endunless -%}
        </ul>
        {% endif -%}

        {%- set cta = module.optional_fields.cta -%}

        {%- if (cta.cta_label is truthy) and (cta.cta_link.url.href is truthy) -%}
        <div class="hsg-fixed-secondary__cta">
          {{ generateCta({
            'label': cta.cta_label,
            'link': cta.cta_link.url.href,
            'class': 'cta--primary cta--small',
            'openInNewTab': cta.cta_link.open_in_new_tab,
            'noCrawl': cta.cta_link.no_follow
          }) }}
        </div>
        {% endif -%}
      </nav>
    </div>
  </section>
</div>
{% endif -%}
